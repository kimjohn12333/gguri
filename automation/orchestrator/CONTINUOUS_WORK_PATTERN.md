# OpenClaw 무중단 작업 패턴 운영 가이드

## 목적
크론(Cron) + 하트비트(Heartbeat) + 서브에이전트(Subagent)를 함께 사용해, 장시간/반복 작업을 끊김 없이 운영한다.

## 1) 역할 분리 원칙
- **Cron**: 정확한 시간 기반 트리거(정시 실행, 독립 세션).
- **Heartbeat**: 주기 점검/배치 체크(약간의 시간 오차 허용).
- **Subagent**: 무거운 실행/장기 처리/병렬 작업 처리.

## 2) 권장 실행 패턴
1. **스케줄링(Cron)**
   - 작업 시작 트리거를 Cron으로 생성.
   - 큐(`automation/orchestrator/QUEUE.md`)에 상태를 `PENDING -> IN_PROGRESS`로 갱신.
2. **실행(Subagent)**
   - 각 큐 아이템을 서브에이전트에 위임.
   - 산출물 파일 생성(문서/리포트/결과 로그).
3. **감시(Heartbeat)**
   - 주기적으로 큐 상태 확인.
   - `IN_PROGRESS`가 오래 지속되면 재시도 규칙 적용.
4. **종료 처리**
   - 성공 시 `DONE` + notes에 1~2줄 요약.
   - 실패 시 `FAILED` + 원인/재시도 조건 기록.

## 3) 최소 운영 체크리스트
- [ ] 큐 row에 `id`, `task`, `success_criteria`가 체크 가능하게 작성됨
- [ ] 실행 시작 시각(`started_at_kst`) 기록됨
- [ ] 산출물이 워크스페이스에 생성됨
- [ ] 완료/실패 시 `notes`에 요약이 남음

## 4) 실패/재시도 규칙

### 실패 분류
- **일시적 실패(Transient)**: 네트워크 오류, 도구 타임아웃, 외부 API 일시 장애
- **영구 실패(Permanent)**: 요구사항 모순, 권한 없음, 입력 데이터 결손

### 재시도 정책
- **일시적 실패만 재시도**
- 기본 재시도: 최대 3회
- 백오프: 1분 -> 3분 -> 10분(지수/단계적 증가)
- 같은 오류가 3회 반복되면 `FAILED`로 종료 후 사람 확인 요청

### 상태 전이 규칙
- `PENDING -> IN_PROGRESS`: 실행 시작
- `IN_PROGRESS -> DONE`: 성공 기준 충족 + 산출물 확인
- `IN_PROGRESS -> FAILED`: 재시도 한도 초과 또는 영구 실패
- `IN_PROGRESS -> BLOCKED`: 외부 입력 필요(notes에 필요한 입력 명시)

### notes 작성 규칙(간단)
- 성공: "산출물 경로 + 핵심 결과 1줄"
- 실패: "실패 원인 + 다음 액션 1줄"

## 5) 운영 팁
- Heartbeat는 여러 점검을 한 번에 배치해 API 호출을 줄인다.
- 시간 정확도가 중요한 작업은 Heartbeat 대신 Cron으로 분리한다.
- 장시간 작업은 반드시 서브에이전트로 분리해 메인 세션 지연을 방지한다.
